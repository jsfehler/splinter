# Copyright 2012-2016 splinter authors. All rights reserved.
# Use of this source code is governed by a BSD-style
# license that can be found in the LICENSE file.

sudo: required
services:
  - xvfb
before_install:
  - export DISPLAY=:99.0
  # Get Geckodriver
  - wget https://github.com/mozilla/geckodriver/releases/download/v0.23.0/geckodriver-v0.23.0-linux64.tar.gz
  - mkdir geckodriver
  - tar -xzf geckodriver-v0.23.0-linux64.tar.gz -C geckodriver
  - export PATH=$PATH:$PWD/geckodriver
  # Get Chromedriver
  - CHROMEVERSION=$(google-chrome --version | grep -Eo "([0-9]{1,3})" | head -1)
  - LATESTRELEASE=$(curl https://chromedriver.storage.googleapis.com/LATEST_RELEASE_${CHROMEVERSION})
  - FILE=`mktemp`; wget https://chromedriver.storage.googleapis.com/${LATESTRELEASE}/chromedriver_linux64.zip -qO $FILE && unzip $FILE chromedriver -d ~; rm $FILE; chmod 777 ~/chromedriver;
  - export PATH=$HOME:$PATH
  # Start Selenium
  - wget https://goo.gl/s4o9Vx -O selenium-server.jar
  - java -jar selenium-server.jar > /dev/null 2>&1 &
  - sleep 1
language: python
addons:
  chrome: stable
  firefox: "62.0"
matrix:
  include:
    - python: 2.7
      env:
        - DJANGO_VERSION=1.7.11
        - TOX_ENV=py27
    - python: 3.6
      env:
        - DJANGO_VERSION=2.0.6
        - TOX_ENV=py36
    - python: 3.7
      env:
        - DJANGO_VERSION=2.0.6
        - TOX_ENV=py37
    - python: 3.8-dev
      env:
        - DJANGO_VERSION=2.0.6
        - TOX_ENV=py38
install:
  - export PATH=$HOME:$PATH
  - make dependencies
  - pip install tox
  - pip install -q Django==$DJANGO_VERSION
script: tox -e $TOX_ENV
dist: xenial
